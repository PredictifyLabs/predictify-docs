name: Prevent Direct Push to Protected Branches

on:
  push:
    branches:
      - master
      - develop

jobs:
  block-direct-push:
    runs-on: ubuntu-latest
    steps:
      - name: Detect direct push
        run: |
          echo "Ref: $GITHUB_REF"
          echo "Event: $GITHUB_EVENT_NAME"

          # Si el push NO viene desde un Pull Request → bloquear
          if [[ "$GITHUB_EVENT_NAME" != "pull_request" && "$GITHUB_EVENT_NAME" != "pull_request_target" ]]; then
            echo "❌ Direct push detected on $GITHUB_REF. Only PR merges are allowed."
            exit 1
          fi

          echo "✔ Protected branch policy satisfied. Merge from PR detected."
